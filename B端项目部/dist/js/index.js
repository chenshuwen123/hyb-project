"use strict";angular.module("app",["ui.router"]),angular.module("app",["ui.router","Encrypt"]).config(["$stateProvider","$urlRouterProvider",function(e,t){var o="views/logins/",r=o+"registerMessage/",n=o+"forget/";e.state("login",{url:"/login",views:{top:{templateUrl:"views/logins/login1.html"}}}).state("loginUser",{url:"/register",views:{top:{templateUrl:r+"register1.html"}}}).state("succeed",{url:"/succeed",views:{top:{templateUrl:r+"register/success.html"}}}).state("information",{url:"/information",views:{top:{templateUrl:r+"register/information.html"}}}).state("personM",{url:"/personM",views:{top:{templateUrl:r+"register/people.html"}}}).state("forgetPassWorld",{url:"/forget",views:{top:{templateUrl:n+"forgetPage1.html"}}}).state("forgetNext",{url:"/page2",views:{top:{templateUrl:n+"page2/forgetPage2.html"}}}).state("forgetN",{url:"/page3",views:{top:{templateUrl:n+"page2/page3/forgetN.html"}}}).state("forget2",{url:"/page4",views:{top:{templateUrl:n+"page2/page3/page4/forget4.html"}}}).state("main",{url:"/main",views:{top:{templateUrl:"views/main.html"}}}),t.otherwise("/login")}]).directive("hello",function(){return{restrict:"ECMA",transclude:!0,templateUrl:"views/logins/directivePage/loginDirective.html"}}).directive("forget",function(){return{restrict:"ECMA",transclude:!0,templateUrl:"views/logins/directivePage/forgetD.html"}}).directive("setFocus",[function(){return{scope:!1,link:function(e,t){e.$watch("isFocus",function(e,o,r){e&&r.isCome&&(t[0].focus(),alert("猴哥，老牛不在家，我一介女子还不是你说什么我就照做，可你进入人家的身体也不打声招呼，进了就进了，还搞得我那么难受，求你别搞了，给，芭~~~蕉~~~扇！"))},!0)}}}]),angular.module("app").service("www",["$http",function(e){this.api=function(){var e="http://59.110.164.152";return e}}]),angular.module("app").service("https",["$http","storageUser","$rootScope","$state","www",function(e,t,o,r,n){var a=n.api();this.forgetInIt=function(){var e=JSON.parse(sessionStorage.getItem("number"));null==e&&r.go("login")},this.phoneNum=function(){var e=JSON.parse(sessionStorage.getItem("number"));if(null==e)return fale},this.tokenInit=function(){var e=JSON.parse(sessionStorage.getItem("tokens"));return null!=e},this.token=function(){var e=JSON.parse(sessionStorage.getItem("tokens")).token;return e},this.jump=function(e){return r.go(e)},this.loginMessage=function(e){var t=new RegExp(/^[0-9a-zA-Z@.-_]{6,16}$/);return!!t.test(e)},this.userPassworld=function(e){var t=new RegExp(/^(\w){8,16}$/);return!!t.test(e)},this.kaptcha=function(e){var t=new RegExp(/^[0-9a-zA-Z]{1,5}$/);return!!t.test(e)},this.phoneCode=function(e){var t=new RegExp(/^[0-9]{1,6}$/);return!!t.test(e)},this.companyFullName=function(e){var t=new RegExp(/^[\u4e00-\u9fa5a-zA-Z0-9\(\)]{2,32}$/);return!!t.test(e)},this.companyS=function(e){var t=new RegExp(/^[\u4e00-\u9fa5a-zA-Z0-9\(\)]{2,20}$/);return!!t.test(e)},this.phoneMessage=function(e){var t=new RegExp(/^1[34578]\d{9}$/);return!!t.test(e)},this.phoneCodeNumber=function(e){var t=new RegExp(/^\d{1}$/);return!!t.test(e)},this.setKey=function(){var e=null;e=window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null,e&&(e.open("GET",a+"/hyb-entuser/ent_user/uniqueKey",!1),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var t=JSON.parse(sessionStorage.getItem("key"));if(null==t){var o=e.getResponseHeader("SET_UNIQUE_KEY");sessionStorage.setItem("key",JSON.stringify({key:o}));JSON.parse(sessionStorage.getItem("key")).key}}},e.send())}}]),angular.module("app").factory("$post",["$http","www",function(e,t){var o=t.api();return{postUserLogin:function(t,r){return e({method:"POST",data:t,url:o+"/hyb-entuser/ent_user/login",headers:{UNIQUE_KEY:r}})},postRegister:function(t){return e({method:"GET",url:o+"/hyb-entuser/kaptcha",headers:{UNIQUE_KEY:t}})},postMessage:function(t,r){return e({method:"POST",url:o+"/hyb-entuser/ent_user/register",data:t,headers:{UNIQUE_KEY:r}})},postCompangMessage:function(t){return e({method:"POST",url:o+"/hyb-ent/ent_info/update",data:t})},postAddPerson:function(t){return e({method:"POST",url:o+"/hyb-ent/ent_info/create_linkman",data:t})},postPersonCode:function(t){return e({method:"POST",url:o+"/hyb-ent/mobile/send",data:t})},postForgetNum:function(t,r){return e({method:"POST",url:o+"/hyb-entuser/mobile/send",data:t,headers:{UNIQUE_KEY:r}})},postForgetValid:function(t,r){return e({method:"POST",url:o+"/hyb-entuser/mobile/valid_mess",data:t,headers:{UNIQUE_KEY:r}})},postNumCode:function(t,r){return e({method:"POST",url:o+"/hyb-entuser/mobile/resend",data:t,headers:{UNIQUE_KEY:r}})},postChangePasswd:function(t,r){return e({method:"POST",url:o+"/hyb-entuser/ent_user/change_passwd",data:t,headers:{UNIQUE_KEY:r}})},getKaptcha:function(t){return e({method:"GET",url:o+"/hyb-entuser/kaptcha",headers:{UNIQUE_KEY:t}})},getJson:function(){return e({method:"GET",url:"data/hangye.json"})}}}]),angular.module("app").service("storageUser",["$rootScope",function(e){this.getStorage=function(e){return localStorage.getItem(e)},this.setStorage=function(e,t){localStorage.setItem(e,t)},this.removeStorage=function(e){localStorage.removeItem(e)}}]),angular.module("app").controller("forget",["$scope","https","$state","$interval","$post","$http","$rootScope","Md5",function(e,t,o,r,n,a,s,i){var c=JSON.parse(sessionStorage.getItem("key")).key;e.phoneCode={mobile:"",kaptcha:""},n.getKaptcha(c).then(function(t){var o=t.data.data.img;e.imgSrc=o}),e.phoneNumClick=function(){n.getKaptcha(c).then(function(t){var o=t.data.data.img;e.imgSrc=o})},e.go=function(r){var a=e.phoneCode.mobile,s=t.phoneMessage(e.phoneCode.mobile),i=t.kaptcha(e.phoneCode.kaptcha);if(s||(e.mobile="手机号输入错误",e.forgetM=!0),i||(e.forgetK=!0,e.kaptcha="验证码输入有误"),e.forgetMobile=function(){e.forgetM=!1,e.mobile=""},e.forgetKaptcha=function(){e.forgetK=!1,e.kaptcha=""},s&&i){var c=JSON.parse(sessionStorage.getItem("key")).key,u=e.phoneCode.kaptcha.toLowerCase();sessionStorage.setItem("number",JSON.stringify({phone:a}));var p={mobile:e.phoneCode.mobile,kaptcha:u};n.postForgetNum(p,c).then(function(t){var r=t.data;"0"==r.code&&r.data.success?(console.log(t),o.go("forgetNext")):"0"==r.code&&0==r.data.success&&(n.getKaptcha(c).then(function(t){var o=t.data.data.img;e.imgSrc=o}),e.mobile=r.data.errors.mobile,e.kaptcha=r.data.errors.kaptcha),"400"==r.code&&(e.kaptcha=r.reason)})}}}]),angular.module("app").controller("login",["$scope","https","$state","$interval","$post","$http","$rootScope","Md5","storageUser",function(e,t,o,r,n,a,s,i,c){e.user={loginName:"",password:"",imgCode:""};var u=c.getStorage("userName");if(null!=u){var p=JSON.parse(c.getStorage("userName")).name;console.log(p),e.user.loginName=p}e.f=!1,null!=JSON.parse(sessionStorage.getItem("number"))&&sessionStorage.removeItem("number");var g=JSON.parse(sessionStorage.getItem("key"));null==g&&t.setKey(),e.imageClick=function(){var t=JSON.parse(sessionStorage.getItem("key")).key;n.getKaptcha(t).then(function(t){var o=t.data.data.img;e.imgSrc=o})},e.login_click=function(){var r=t.loginMessage(e.user.loginName),a=t.userPassworld(e.user.password),s=(t.kaptcha(e.user.imgCode),i.hex_md5(e.user.password));e.LowerCase=e.user.imgCode.toLowerCase();var u={loginName:e.user.loginName,password:s,imgCode:e.LowerCase};if(1==a&&1==r){var p=JSON.parse(sessionStorage.getItem("key")).key;e.loginUserName=!0,n.postUserLogin(u,p).then(function(t){var r=t.data;if("0"==r.code&&r.data.success){var a=r.data.token;c.setStorage("userName",JSON.stringify({name:e.user.loginName})),sessionStorage.setItem("tokens",JSON.stringify({token:a})),o.go("main")}else"0"==r.code&&0==r.data.success?(e.m=r.data.message,"验证码错误"==r.data.message&&(e.userCode=!0,n.getKaptcha(p).then(function(t){var o=t.data.data.img;e.imgSrc=o}))):"402"==r.code?(n.getKaptcha(p).then(function(t){var o=t.data.data.img;e.imgSrc=o}),e.m=r.reason,e.f=!0,e.foot=!0):"400"==r.code&&"验证码不能为空"==r.reason&&(e.f=!0,n.getKaptcha(p).then(function(t){var o=t.data.data.img;e.imgSrc=o}))})}r?e.loginUserName=!1:(e.loginUserName=!0,e.m=" *用户名／密码错误"),a?e.loginUserPass=!1:(e.loginUserPass=!0,e.m="*用户名／密码错误")},e.userNameF=function(){e.loginUserName=!1},e.passF=function(){e.loginUserPass=!1},e.code=function(){e.userCode=!1}}]),angular.module("app").controller("postCode",["$scope","https","$state","$interval","$post","$stateParams","$rootScope","Md5",function(e,t,o,r,n,a,s,i){function c(){0==p?(e.ff=!1,p=60,e.postCode="(60) 重新发送",r.cancel(g)):(e.ff=!0,e.postCode="("+p+") 重新发送",p--)}if(t.forgetInIt(),null!=JSON.parse(sessionStorage.getItem("number"))){var u=JSON.parse(sessionStorage.getItem("number")).phone;e.number=u}var p=60;if(e.ff=!0,60==p)var g=r(function(){c()},1e3);e.phoneCodes=function(){var e=JSON.parse(sessionStorage.getItem("key")).key,t=(r(function(){c()},1e3),{mobile:u});n.postNumCode(t,e).then(function(e){console.log(e)})},e.number1="",e.number2="",e.number3="",e.number4="",e.number5="",e.number6="",e.up=function(){console.log(111111)},e.forgetNext=function(){var r=JSON.parse(sessionStorage.getItem("key")).key,a=JSON.parse(sessionStorage.getItem("number")).phone;e.number=a;var i=t.phoneCodeNumber,c=i(e.number1),u=i(e.number2),p=i(e.number3),g=i(e.number4),l=i(e.number5),m=i(e.number6);if(c&&u&&p&&g&&l&&m){var d=[];d.push(e.number1),d.push(e.number2),d.push(e.number3),d.push(e.number4),d.push(e.number5),d.push(e.number6);var h=d.join("");s.string=h;var f={mobile:a,mess:h};n.postForgetValid(f,r).then(function(t){console.log(t);var r=t.data;"0"==r.code&&r.data.success?o.go("forgetN"):"0"!=r.code||r.data.success||(e.mess=r.data.errors.mess)})}};e.passwd="",e.forgetClick=function(){var r=JSON.parse(sessionStorage.getItem("key")).key,a=JSON.parse(sessionStorage.getItem("number")).phone;e.number=a;var c=t.userPassworld(e.passwd);if(c){e.Md5=i.hex_md5(e.passwd);var u={mess:s.string,passwd:e.Md5,mobile:a};n.postChangePasswd(u,r).then(function(e){var t=e.data;console.log(t),"0"==t.code&&t.data.success&&o.go("forget2")})}else e.color=!0,e.passError="密码格式输入有误"},e.forget3=function(){e.color=!1,e.passError=""}}]),angular.module("app").controller("register",["$scope","https","$state","$interval","$post","$http","$rootScope","Md5",function(e,t,o,r,n,a,s,i){t.tokenInit();var c=JSON.parse(sessionStorage.getItem("key")).key;e.register={user_name:"",passwd:"",kaptcha:""},n.getKaptcha(c).then(function(t){var o=t.data.data.img;e.imgSrc=o}),e.imageClick=function(){n.getKaptcha(c).then(function(t){var o=t.data.data.img;e.imgSrc=o})},e.successClick=function(){var r=JSON.parse(sessionStorage.getItem("key")).key,a=t.loginMessage(e.register.user_name),s=t.userPassworld(e.register.passwd),c=t.kaptcha(e.register.kaptcha);e.Md5=i.hex_md5(e.register.passwd),e.LowerCase=e.register.kaptcha.toLowerCase();var u={user_name:e.register.user_name,passwd:e.Md5,kaptcha:e.LowerCase};a&&s&&c&&n.postMessage(u,r).then(function(t){console.log(t);var a=t.data;if("0"==a.code&&a.data.success){var s=a.data.token;sessionStorage.setItem("tokens",JSON.stringify({token:s})),o.go("succeed")}else{console.log(a);var i=a.data.errors.kaptcha,c=a.data.errors.user_name;a.data.errors.passwd;e.nameError=c,e.kaptchaError=i,n.getKaptcha(r).then(function(t){var o=t.data.data.img;e.imgSrc=o});var u=(a.description,a.reason);console.log(u)}}),a?(e.nameError="",e.borderColor=!1):(e.nameError="*账号输入错误",e.borderColor=!0),s?(e.passE="",e.passColor=!1):(e.passE="*密码输入错误",e.passColor=!0),c?(e.kaptchaError="",e.kaptchaColor=!1):(e.kaptchaError="*验证码错误",e.kaptchaColor=!0)},e.registerFocus=function(){e.borderColor=!1,e.nameError=""},e.registerPassFocus=function(){e.passE="",e.passColor=!1},e.registerKaptchaFocus=function(){e.kaptchaError="",e.kaptchaColor=!1}}]),angular.module("app").controller("companys",["$scope","https","$state","$interval","$post","$http","$rootScope","Md5",function(e,t,o,r,n,a,s,i){t.tokenInit()||o.go("login"),e.companys={token:"",full_name:"",short_name:"",industry_type:"",province:""},e.companyClick=function(){var r=t.token();console.log(r);var a=t.companyFullName(e.companys.full_name),s=t.companyS(e.companys.short_name),i=e.companys.industry_type,c=e.companys.province;if(a&&s&&""!=c){var u={token:r,full_name:e.companys.full_name,short_name:e.companys.short_name,industry_type:e.companys.industry_type,province:e.companys.province},p=JSON.parse(sessionStorage.getItem("key")).key;n.postCompangMessage(u,p).then(function(t){var r=t.data;console.log(r),"0"==r.code&&r.data.success?o.go("personM"):(console.log(r),e.companysError=r.data.errors.full_name)})}a?(e.companysError="",e.companyAllColor=!1):(e.companysError="*公司名称输入错误",e.companyAllColor=!0),s?(e.companyError="",e.companyColor=!1):(e.companyError="*公司简称输入错误",e.companyColor=!0),""==i&&(e.IndustryColor=!0,e.Industry="请选择行业"),""==c&&(e.companyAddress=!0,e.province="请选择公司所在城市")},e.companyAllFocus=function(){e.companysError="",e.companyAllColor=!1},e.companyFocus=function(){e.companyError="",e.companyColor=!1},e.industryF=function(){e.IndustryColor=!1,e.Industry=""},n.getJson().then(function(t){e.json=t.data}),e.focusIndex=0,e.focus=function(t){e.focusIndex=t},e.toggleMessage=!1;var c=!0;e.toggleM=!1;var u=!0;e.toggleS=function(){e.toggleM=!1,e.toggleMessage=!e.toggleMessage,c?(e.check=!0,c=!1):(e.check=!1,c=!0)},e.chooseItem=function(t,o){e.indexs=o,e.toggleMessage=!1,e.check=!1,e.companys.industry_type=t},e.toggle=function(){e.province="",e.companyAddress=!1,e.toggleMessage=!1,e.toggleM=!e.toggleM,u?(e.checkF=!0,u=!1):(u=!0,e.checkF=!1)},e.cityClick=function(t){e.companys.province=t,e.toggleM=!1,e.checkF=!1}}]),angular.module("app").controller("information",["$scope","https","$state","$interval","$post","$http","$rootScope","Md5",function(e,t,o,r,n,a,s,i){if(t.tokenInit())var c=t.token();else o.go("login");e.contact={mobile:"",linkman:"",sms_code:"",sex:"",token:c},e.radioSex=function(t){e.peopleError="",e.contact.sex=t,"1"==t?(e.Mr=!0,e.Mrs=!1):(e.Mrs=!0,e.Mr=!1)},e.messageClick=function(){console.log("-======="),console.log(e.contact.sex);var r=t.companyS(e.contact.linkman),a=t.phoneMessage(e.contact.phone),s=t.phoneCode(e.contact.sms_code),i=e.contact.sex,u={mobile:e.contact.phone,linkman:e.contact.linkman,sms_code:e.contact.sms_code,sex:i,token:c};r&&a&&s&&""!=i&&n.postAddPerson(u).then(function(t){var r=t.data;"0"==r.code&&r.data.success?o.go("login"):"0"==r.code&&0==r.data.success&&(e.phoneNumberError=r.data.errors.mobile),"400"==t.data.code&&(e.phoneCodeError=t.data.reason)}),""==i&&(e.peopleError="请选择性别"),r?e.contactUserColor=!1:(e.contactUserColor=!0,e.peopleError="请输入联系人"),a?e.phoneNumber=!1:(e.phoneNumber=!0,e.phoneNumberError="请输入正确的手机号码"),s?e.phoneCode=!1:(e.phoneCode=!0,e.phoneCodeError="手机验证码错误")},e.userFocus=function(){e.contactUserColor=!1,e.peopleError=""},e.phoneFocus=function(){e.phoneNumber=!1,e.phoneNumberError=""},e.codeFocus=function(){e.phoneCode=!1,e.phoneCodeError=""},e.f=!1,e.time="发送验证码",e.phoneCodes=function(){var o=t.phoneMessage(e.contact.phone),a={mobile:e.contact.phone};console.log(a),o?n.postPersonCode(a).then(function(t){function o(){0==n?(e.f=!1,n=60,e.time="重新发送(60)",r.cancel(s)):(e.time="重新发送("+n+")",n--)}console.log(a);var n=60;if(e.f=!0,60==n)var s=r(function(){o()},1e3)}):(e.phoneNumber=!0,e.phoneNumberError="手机号输入不合法")},n.getJson().then(function(t){e.json=t.data})}]);